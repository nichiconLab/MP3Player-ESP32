README (Original version)

オーディオプレーヤー
ソフトウェアver.6

ESP8266AudioライブラリやAdafruit_GFXライブラリ等の自作ではないライブラリも使用しており、万が一開発者から知的財産権等の指摘があった場合は削除します。


機能(functions)
・音量変更（20段階）
・曲選択
・再生、停止ボタン
ver.2で追加した機能
・自動再生機能（1曲のみ、1曲永久ループ、全曲再生）
ver.3で追加した機能
・プレイリスト機能（フォルダごとにプレイリストとして扱う）

対応フォーマット(music format)
・mp3 (max 16bit,48kHz)

ハードウェアの仕様(hardware specification)
Microcontroller: ESP32-WROOM-32E
  CPU clock: 240MHz
  FLASH: 4MB
DAC: PCM5102A
  Interface: I2S
  Resolution: 32bit
  Max frequency: 384kHz
  LPF: 470Ω + 2200pF (cut-off: 153.9kHz)
LCD: MSP2807
  Interface: SPI
  LCD driver: ILI9341
  Touch controller: TSC2046
Battery: Litium polimer
  Voltage: 3.82V (3.3~4.3V)
  Capacity: 1821mAh
  Manifacturer: Apple Inc. (This battery from iPhone SE2)
Charge controller: MCP73831
  Charge current: 500mA


仕様変更ログ(change logs)
ver.3.1.1
起動時にnichicon labの文字とロゴを表示

ver.3.1.2
MODE_LOOP_MUSICの時に途中で曲を変えるとタイトルが更新されない問題を修正

ver.3.1.3
mp3ファイルのパスが正常に指定されていなかった問題を修正

ver.3.2.1 (2024/05/05)
消費電力削減および駆動時間向上のために一定時間操作が無い場合ディスプレイのバックライトを消灯させる処理を追加
これに伴いバックライトの制御回路を追加した

ver.3.2.2 (2024/07/15)
バッテリーをiPhone SE2から取り出したものに交換した
バッテリーの最大電圧が4.2Vから4.3Vに変わったため、バッテリー残量の計算式を修正
また、バッテリー充電ICを搭載し充電管理を行えるようになった
ICのSTAT端子がオープンドレイン出力になっているので内部プルアップと組み合わせて充電状態も取得可能（未実装）
→ICのSTAT端子はプッシュプル出力(2024/08/15追記)

ver.3.2.3 (2024/08/15)
ディスプレイの初期化が終わってからバックライトを点灯させるよう変更した
これによって起動直後に真っ白な画面が表示されなくなる
また、画面がスリープする前に少し暗くなった状態で画面をタッチしても反応しないよう修正した

ver.3.2.4X (未修正)
MODE_AUTOで再生中にプレイリストを切り換えると次のプレイリストが2曲目からスタートしてしまう問題を修正

ver.4.1.1 (2024/09/24)
人間の聴覚に合わせてボリュームを指数関数的に調整できるように変更した

ver.4.2.1 (2024/10/20)
曲の再生位置を視覚的に表示できるように変更した。

ver.4.3.1 (2024/11/02)
電源スイッチをスライドスイッチからプッシュスイッチに変更
ESP32でスイッチの状態を読みディープスリープさせる

ver.6.1.1X (2025/02/20?)
プリント基板製作にあたって充電ICからバッテリーの充電状態を取得できるように機能を追加


バージョン変更ルール(rule of version change)
ver.A.B.C(X)
A: ハードウェアの変更などを伴う大規模な変更を行った際に変更
B: ソフトウェアで機能を追加した際に変更
C: バグ対応など軽微な修正の際に変更
実装予定だが未実装のバージョンには最後にXを付ける